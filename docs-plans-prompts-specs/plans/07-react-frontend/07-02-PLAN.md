---
phase: 07-react-frontend
plan: 02
type: execute
domain: react-web
---

<objective>
Implement landing page with product features and authentication screens (login, register).
</objective>

<context>
@BRIEF.md
@codestory/frontend/src/App.tsx
</context>

<tasks>

<task type="auto">
  <n>Task 1: Create API client and auth context</n>
  <files>codestory/frontend/src/lib/api.ts, codestory/frontend/src/contexts/AuthContext.tsx</files>
  <action>
Create API client:

```typescript
// src/lib/api.ts
const API_BASE = '/api'

interface ApiResponse<T> {
  data?: T
  error?: string
}

class ApiClient {
  private token: string | null = null

  setToken(token: string | null) {
    this.token = token
    if (token) {
      localStorage.setItem('access_token', token)
    } else {
      localStorage.removeItem('access_token')
    }
  }

  getToken(): string | null {
    if (!this.token) {
      this.token = localStorage.getItem('access_token')
    }
    return this.token
  }

  private async request<T>(
    endpoint: string,
    options: RequestInit = {}
  ): Promise<ApiResponse<T>> {
    const headers: HeadersInit = {
      'Content-Type': 'application/json',
      ...options.headers,
    }

    const token = this.getToken()
    if (token) {
      headers['Authorization'] = `Bearer ${token}`
    }

    try {
      const response = await fetch(`${API_BASE}${endpoint}`, {
        ...options,
        headers,
      })

      if (!response.ok) {
        const error = await response.json()
        return { error: error.error || 'Request failed' }
      }

      const data = await response.json()
      return { data }
    } catch (err) {
      return { error: 'Network error' }
    }
  }

  get<T>(endpoint: string) {
    return this.request<T>(endpoint, { method: 'GET' })
  }

  post<T>(endpoint: string, body: unknown) {
    return this.request<T>(endpoint, {
      method: 'POST',
      body: JSON.stringify(body),
    })
  }

  delete<T>(endpoint: string) {
    return this.request<T>(endpoint, { method: 'DELETE' })
  }
}

export const api = new ApiClient()
```

Create auth context:

```typescript
// src/contexts/AuthContext.tsx
import { createContext, useContext, useState, useEffect, ReactNode } from 'react'
import { api } from '@/lib/api'

interface User {
  id: string
  email: string
  name: string
}

interface AuthContextType {
  user: User | null
  isLoading: boolean
  login: (email: string, password: string) => Promise<{ error?: string }>
  register: (email: string, password: string, name: string) => Promise<{ error?: string }>
  logout: () => void
}

const AuthContext = createContext<AuthContextType | null>(null)

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null)
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    // Check for existing session
    const checkAuth = async () => {
      const token = api.getToken()
      if (token) {
        const { data, error } = await api.get<User>('/auth/me')
        if (data) setUser(data)
        else api.setToken(null)
      }
      setIsLoading(false)
    }
    checkAuth()
  }, [])

  const login = async (email: string, password: string) => {
    const { data, error } = await api.post<{ access_token: string; refresh_token: string }>('/auth/login', { email, password })
    if (error) return { error }
    
    api.setToken(data!.access_token)
    localStorage.setItem('refresh_token', data!.refresh_token)
    
    const { data: userData } = await api.get<User>('/auth/me')
    if (userData) setUser(userData)
    
    return {}
  }

  const register = async (email: string, password: string, name: string) => {
    const { data, error } = await api.post<{ access_token: string; refresh_token: string }>('/auth/register', { email, password, name })
    if (error) return { error }
    
    api.setToken(data!.access_token)
    localStorage.setItem('refresh_token', data!.refresh_token)
    
    const { data: userData } = await api.get<User>('/auth/me')
    if (userData) setUser(userData)
    
    return {}
  }

  const logout = () => {
    api.setToken(null)
    localStorage.removeItem('refresh_token')
    setUser(null)
  }

  return (
    <AuthContext.Provider value={{ user, isLoading, login, register, logout }}>
      {children}
    </AuthContext.Provider>
  )
}

export function useAuth() {
  const context = useContext(AuthContext)
  if (!context) throw new Error('useAuth must be used within AuthProvider')
  return context
}
```
  </action>
  <verify>cd codestory/frontend && npm run build</verify>
  <done>API client and auth context created</done>
</task>

<task type="auto">
  <n>Task 2: Create landing page and auth pages</n>
  <files>codestory/frontend/src/pages/LandingPage.tsx, codestory/frontend/src/pages/LoginPage.tsx, codestory/frontend/src/pages/RegisterPage.tsx</files>
  <action>
Create LandingPage:

```typescript
// src/pages/LandingPage.tsx
import { Link } from 'react-router-dom'
import { Button } from '@/components/ui/button'
import { Play, Code, Mic, Headphones } from 'lucide-react'

export function LandingPage() {
  return (
    <div className="min-h-screen bg-gradient-to-b from-background to-muted">
      <header className="container mx-auto px-4 py-6 flex justify-between items-center">
        <h1 className="text-2xl font-bold">Code Story</h1>
        <div className="space-x-4">
          <Link to="/login">
            <Button variant="ghost">Login</Button>
          </Link>
          <Link to="/register">
            <Button>Get Started</Button>
          </Link>
        </div>
      </header>

      <main className="container mx-auto px-4 py-20">
        <div className="text-center max-w-3xl mx-auto">
          <h2 className="text-5xl font-bold mb-6">
            Turn Code into Audio Stories
          </h2>
          <p className="text-xl text-muted-foreground mb-8">
            Transform any GitHub repository into an engaging audio narrative.
            Learn codebases through stories, not documentation.
          </p>
          <Link to="/register">
            <Button size="lg" className="gap-2">
              <Play className="h-5 w-5" />
              Start Listening
            </Button>
          </Link>
        </div>

        <div className="grid md:grid-cols-3 gap-8 mt-20">
          <FeatureCard
            icon={<Code className="h-8 w-8" />}
            title="Any Repository"
            description="Paste a GitHub URL and we analyze the entire codebase"
          />
          <FeatureCard
            icon={<Mic className="h-8 w-8" />}
            title="AI Narration"
            description="Choose from multiple narrative styles tailored to your needs"
          />
          <FeatureCard
            icon={<Headphones className="h-8 w-8" />}
            title="Listen Anywhere"
            description="Download or stream your code stories on any device"
          />
        </div>
      </main>
    </div>
  )
}

function FeatureCard({ icon, title, description }: { icon: React.ReactNode; title: string; description: string }) {
  return (
    <div className="p-6 rounded-lg border bg-card">
      <div className="text-primary mb-4">{icon}</div>
      <h3 className="text-lg font-semibold mb-2">{title}</h3>
      <p className="text-muted-foreground">{description}</p>
    </div>
  )
}
```

Create LoginPage and RegisterPage:

```typescript
// src/pages/LoginPage.tsx
import { useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { useAuth } from '@/contexts/AuthContext'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from '@/components/ui/card'
import { useToast } from '@/components/ui/use-toast'

export function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const { login } = useAuth()
  const navigate = useNavigate()
  const { toast } = useToast()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsLoading(true)
    
    const { error } = await login(email, password)
    
    if (error) {
      toast({ title: 'Error', description: error, variant: 'destructive' })
    } else {
      navigate('/dashboard')
    }
    
    setIsLoading(false)
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-muted/50">
      <Card className="w-full max-w-md">
        <CardHeader>
          <CardTitle>Welcome back</CardTitle>
          <CardDescription>Sign in to your Code Story account</CardDescription>
        </CardHeader>
        <form onSubmit={handleSubmit}>
          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="password">Password</Label>
              <Input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
              />
            </div>
          </CardContent>
          <CardFooter className="flex flex-col gap-4">
            <Button type="submit" className="w-full" disabled={isLoading}>
              {isLoading ? 'Signing in...' : 'Sign In'}
            </Button>
            <p className="text-sm text-muted-foreground">
              Don't have an account?{' '}
              <Link to="/register" className="text-primary hover:underline">
                Sign up
              </Link>
            </p>
          </CardFooter>
        </form>
      </Card>
    </div>
  )
}
```

```typescript
// src/pages/RegisterPage.tsx
import { useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { useAuth } from '@/contexts/AuthContext'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from '@/components/ui/card'
import { useToast } from '@/components/ui/use-toast'

export function RegisterPage() {
  const [name, setName] = useState('')
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const { register } = useAuth()
  const navigate = useNavigate()
  const { toast } = useToast()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsLoading(true)
    
    const { error } = await register(email, password, name)
    
    if (error) {
      toast({ title: 'Error', description: error, variant: 'destructive' })
    } else {
      navigate('/dashboard')
    }
    
    setIsLoading(false)
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-muted/50">
      <Card className="w-full max-w-md">
        <CardHeader>
          <CardTitle>Create account</CardTitle>
          <CardDescription>Start turning code into stories</CardDescription>
        </CardHeader>
        <form onSubmit={handleSubmit}>
          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="name">Name</Label>
              <Input
                id="name"
                value={name}
                onChange={(e) => setName(e.target.value)}
                required
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="password">Password</Label>
              <Input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                minLength={8}
                required
              />
            </div>
          </CardContent>
          <CardFooter className="flex flex-col gap-4">
            <Button type="submit" className="w-full" disabled={isLoading}>
              {isLoading ? 'Creating account...' : 'Create Account'}
            </Button>
            <p className="text-sm text-muted-foreground">
              Already have an account?{' '}
              <Link to="/login" className="text-primary hover:underline">
                Sign in
              </Link>
            </p>
          </CardFooter>
        </form>
      </Card>
    </div>
  )
}
```
  </action>
  <verify>cd codestory/frontend && npm run build</verify>
  <done>Landing and auth pages created</done>
</task>

</tasks>

<playwright_validation_gate>
```
# Landing page
Playwright Action: Navigate to /
Assert: "Code Story" heading visible
Assert: "Get Started" button visible

# Login flow
Playwright Action: Navigate to /login
Playwright Action: Fill email "test@example.com"
Playwright Action: Fill password "password123"
Playwright Action: Click "Sign In"
Expected: Redirect to /dashboard on success

# Register flow
Playwright Action: Navigate to /register
Playwright Action: Fill name, email, password
Playwright Action: Click "Create Account"
Expected: Account created, redirect to /dashboard
```
</playwright_validation_gate>
