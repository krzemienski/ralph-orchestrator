---
phase: 04-story-architect
plan: 01
type: execute
domain: python-api
---

<objective>
Implement the 5 narrative style prompts for story generation: Fiction, Documentary, Tutorial, Podcast, and Technical.

Purpose: Create distinct voice and structure templates for each narrative style.
Output: Style prompt templates with chapter structure patterns and voice directions.
</objective>


<context>
@BRIEF.md
@ROADMAP.md
@codestory/backend/core/config.py
</context>

<opus_4_5_considerations>
Narrative styles should:
- Have distinct voice characteristics (formal vs casual, dramatic vs informative)
- Include chapter structure templates appropriate to each style
- Provide voice synthesis directions (pace, emphasis, pauses)
- Support different expertise levels (beginner, intermediate, expert)

Opus 4.5 prompt guidelines:
- Use clear, directive language without being overly prescriptive
- Allow creative flexibility within style constraints
- Include examples of tone and phrasing for each style
</opus_4_5_considerations>

<tasks>

<task type="auto">
  <n>Task 1: Create narrative style definitions and prompts</n>
  <files>codestory/backend/skills/story/styles.py</files>
  <action>
Create the 5 narrative style templates:

```python
"""Narrative style definitions for Code Story."""

from dataclasses import dataclass, field
from enum import Enum
from typing import Any


class NarrativeStyle(str, Enum):
    """Available narrative styles for code stories."""
    FICTION = "fiction"
    DOCUMENTARY = "documentary"
    TUTORIAL = "tutorial"
    PODCAST = "podcast"
    TECHNICAL = "technical"


class ExpertiseLevel(str, Enum):
    """Target audience expertise level."""
    BEGINNER = "beginner"
    INTERMEDIATE = "intermediate"
    EXPERT = "expert"


@dataclass
class StyleDefinition:
    """Definition of a narrative style."""
    style: NarrativeStyle
    name: str
    description: str
    voice_character: str
    pacing: str  # fast, moderate, slow
    tone: str
    chapter_pattern: list[str]
    example_phrases: list[str]
    voice_directions: dict[str, str]  # synthesis hints


STYLE_DEFINITIONS: dict[NarrativeStyle, StyleDefinition] = {
    NarrativeStyle.FICTION: StyleDefinition(
        style=NarrativeStyle.FICTION,
        name="Fiction",
        description="Epic narrative that transforms code into an adventure story",
        voice_character="Dramatic narrator, like a fantasy audiobook",
        pacing="moderate",
        tone="Epic, dramatic, storytelling",
        chapter_pattern=[
            "The Beginning - Setting the Stage",
            "The Hero Emerges - Core Components",
            "The Journey - How Data Flows",
            "Challenges and Trials - Edge Cases",
            "The Climax - The Main Feature",
            "Resolution - How It All Comes Together",
        ],
        example_phrases=[
            "In the vast digital realm of {repo_name}, a story unfolds...",
            "Our hero, the {component}, stood ready to face any challenge...",
            "Through treacherous conditionals and perilous loops...",
            "And so, the data found its way home, transformed and triumphant.",
        ],
        voice_directions={
            "emphasis": "dramatic pauses before key reveals",
            "pace": "build tension, then release",
            "emotion": "wonder, excitement, resolution",
        },
    ),
    
    NarrativeStyle.DOCUMENTARY: StyleDefinition(
        style=NarrativeStyle.DOCUMENTARY,
        name="Documentary",
        description="Professional documentary-style narration like a tech documentary",
        voice_character="Authoritative narrator, like David Attenborough for code",
        pacing="moderate",
        tone="Informative, measured, insightful",
        chapter_pattern=[
            "Introduction - The Project at a Glance",
            "Origins - Why This Was Built",
            "Architecture - The Grand Design",
            "Key Components - Under the Hood",
            "In Action - How It Works",
            "Impact - What It Achieves",
        ],
        example_phrases=[
            "Here we observe {repo_name} in its natural habitat...",
            "The architecture reveals a fascinating pattern...",
            "Notice how the data flows through these carefully designed channels...",
            "This elegant solution addresses a fundamental challenge...",
        ],
        voice_directions={
            "emphasis": "highlight architectural decisions",
            "pace": "steady, contemplative",
            "emotion": "appreciation, insight, understanding",
        },
    ),
    
    NarrativeStyle.TUTORIAL: StyleDefinition(
        style=NarrativeStyle.TUTORIAL,
        name="Tutorial",
        description="Step-by-step educational walkthrough for learning",
        voice_character="Friendly instructor, like a patient coding mentor",
        pacing="slow",
        tone="Educational, encouraging, clear",
        chapter_pattern=[
            "Welcome - What You'll Learn",
            "Prerequisites - What You Need to Know",
            "Getting Started - The Basics",
            "Core Concepts - Understanding the Foundation",
            "Hands-On - Walking Through the Code",
            "Next Steps - Where to Go From Here",
        ],
        example_phrases=[
            "Let's take a look at how {repo_name} works...",
            "Don't worry if this seems complex at first...",
            "The key thing to understand here is...",
            "Great! Now you understand how this component functions.",
        ],
        voice_directions={
            "emphasis": "clear explanations, repeat key points",
            "pace": "deliberate, with pauses for absorption",
            "emotion": "encouraging, supportive, celebratory",
        },
    ),
    
    NarrativeStyle.PODCAST: StyleDefinition(
        style=NarrativeStyle.PODCAST,
        name="Podcast",
        description="Casual conversational style like a tech podcast episode",
        voice_character="Enthusiastic host, like a tech podcast personality",
        pacing="fast",
        tone="Casual, enthusiastic, conversational",
        chapter_pattern=[
            "Intro - Hey, Welcome Back!",
            "The Hook - Why This Repo is Cool",
            "Deep Dive - Let's Get Into It",
            "Hot Takes - What I Think About the Design",
            "Highlights - The Coolest Parts",
            "Wrap Up - Final Thoughts",
        ],
        example_phrases=[
            "So I've been digging into {repo_name} and honestly, it's pretty cool...",
            "Here's the thing that really got me excited...",
            "Now, I know what you're thinking, but hear me out...",
            "Alright, that's a wrap! Hope you enjoyed this deep dive.",
        ],
        voice_directions={
            "emphasis": "natural conversational emphasis",
            "pace": "energetic, occasional tangents",
            "emotion": "excitement, curiosity, genuine interest",
        },
    ),
    
    NarrativeStyle.TECHNICAL: StyleDefinition(
        style=NarrativeStyle.TECHNICAL,
        name="Technical",
        description="Precise technical documentation read aloud",
        voice_character="Technical reader, clear and precise",
        pacing="moderate",
        tone="Precise, factual, comprehensive",
        chapter_pattern=[
            "Overview - System Description",
            "Architecture - Component Structure",
            "API Reference - Key Interfaces",
            "Implementation Details - How It Works",
            "Configuration - Setup and Options",
            "Summary - Key Takeaways",
        ],
        example_phrases=[
            "This document describes the {repo_name} system...",
            "The architecture consists of the following components...",
            "The primary interface exposes these methods...",
            "Configuration is managed through environment variables...",
        ],
        voice_directions={
            "emphasis": "technical terms, function names",
            "pace": "measured, clear enunciation",
            "emotion": "neutral, professional",
        },
    ),
}


def get_style_definition(style: NarrativeStyle | str) -> StyleDefinition:
    """Get style definition by name or enum."""
    if isinstance(style, str):
        style = NarrativeStyle(style.lower())
    return STYLE_DEFINITIONS[style]


def get_style_prompt(
    style: NarrativeStyle | str,
    expertise: ExpertiseLevel | str = ExpertiseLevel.INTERMEDIATE,
) -> str:
    """Generate the system prompt for a narrative style."""
    definition = get_style_definition(style)
    
    if isinstance(expertise, str):
        expertise = ExpertiseLevel(expertise.lower())
    
    expertise_adjustments = {
        ExpertiseLevel.BEGINNER: "Explain concepts simply. Avoid jargon. Use analogies.",
        ExpertiseLevel.INTERMEDIATE: "Balance technical accuracy with accessibility.",
        ExpertiseLevel.EXPERT: "Use precise technical language. Assume deep knowledge.",
    }
    
    return f'''You are a {definition.voice_character} creating a {definition.name} style code story.

## Style: {definition.name}
{definition.description}

## Voice Characteristics
- Tone: {definition.tone}
- Pacing: {definition.pacing}
- Character: {definition.voice_character}

## Audience
{expertise_adjustments[expertise]}

## Example Phrases
{chr(10).join(f"- {phrase}" for phrase in definition.example_phrases)}

## Voice Synthesis Directions
- Emphasis: {definition.voice_directions.get("emphasis", "natural")}
- Pace: {definition.voice_directions.get("pace", "moderate")}
- Emotion: {definition.voice_directions.get("emotion", "engaged")}

Write content that captures this style authentically. Each chapter should feel like part of a cohesive {definition.name.lower()} narrative.'''


def get_chapter_template(style: NarrativeStyle | str) -> list[str]:
    """Get the chapter pattern for a style."""
    return get_style_definition(style).chapter_pattern
```

Avoid: Generic prompts, missing expertise levels, no voice directions.
  </action>
  <verify>python -c "from codestory.backend.skills.story.styles import NarrativeStyle, get_style_prompt; print(get_style_prompt(NarrativeStyle.FICTION)[:200])"</verify>
  <done>Style definitions import and generate prompts</done>
</task>

<task type="auto">
  <n>Task 2: Create story package structure</n>
  <files>codestory/backend/skills/story/__init__.py</files>
  <action>
Create story skills package:

```python
"""Story generation skills for Code Story."""

from backend.skills.story.styles import (
    NarrativeStyle,
    ExpertiseLevel,
    StyleDefinition,
    STYLE_DEFINITIONS,
    get_style_definition,
    get_style_prompt,
    get_chapter_template,
)

__all__ = [
    "NarrativeStyle",
    "ExpertiseLevel",
    "StyleDefinition",
    "STYLE_DEFINITIONS",
    "get_style_definition",
    "get_style_prompt",
    "get_chapter_template",
]
```
  </action>
  <verify>python -c "from codestory.backend.skills.story import NarrativeStyle, get_style_prompt; print('Story package OK')"</verify>
  <done>Story package exports correctly</done>
</task>

</tasks>

<verification>
- [ ] All 5 narrative styles defined with unique characteristics
- [ ] Each style has chapter patterns and example phrases
- [ ] Voice synthesis directions included for each style
- [ ] Expertise level adjustments work
</verification>

<success_criteria>
- 5 distinct narrative styles with unique voices
- Chapter patterns match style (6 chapters each)
- Voice directions guide synthesis
- Expertise levels modify language complexity
</success_criteria>

<playwright_validation_gate>
```
# Test style endpoint (to be created)
# For now, validation is via import checks
python -c "from codestory.backend.skills.story import NarrativeStyle; assert len(NarrativeStyle) == 5"
```
</playwright_validation_gate>

<o>
# Phase 4 Plan 1: Narrative Style Prompts Summary

**Created 5 narrative style definitions for story generation.**

## Styles Implemented
1. **Fiction** - Epic adventure narrative
2. **Documentary** - Professional documentary style  
3. **Tutorial** - Educational walkthrough
4. **Podcast** - Casual conversational
5. **Technical** - Precise documentation

## Files Created
- `codestory/backend/skills/story/styles.py` - Style definitions
- `codestory/backend/skills/story/__init__.py` - Package exports

## Next Step
Ready for 04-02-PLAN.md (Chapter script generation)
</o>
