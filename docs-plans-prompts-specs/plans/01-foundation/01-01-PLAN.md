---
phase: 01-foundation
type: execute
domain: python-agent-sdk
---

<objective>
Initialize Python project with uv package manager, establish directory structure, and configure core dependencies.

Purpose: Create the foundational project structure that all subsequent development depends on.
Output: Working Python project with proper structure, dependencies installed, and development tooling configured.
</objective>


<context>
@BRIEF.md
@ROADMAP.md
</context>

<tasks>

<task type="auto">
  <n>Task 1: Initialize Python project with uv</n>
  <files>pyproject.toml, .python-version, README.md</files>
  <action>
    Initialize project using uv with Python 3.12+:
    - Run `uv init codestory` to create project
    - Set Python version to 3.12 in .python-version
    - Configure pyproject.toml with project metadata:
      - name: codestory
      - version: 0.1.0
      - description: "Transform code repositories into audio narratives"
      - requires-python: ">=3.12"
    - Add initial dependencies to pyproject.toml:
      - anthropic (Claude API)
      - claude-agent-sdk (Agent SDK)
      - fastapi (Web framework)
      - uvicorn (ASGI server)
      - sqlalchemy (ORM)
      - alembic (Migrations)
      - asyncpg (Async PostgreSQL)
      - httpx (HTTP client)
      - pydantic (Validation)
      - pydantic-settings (Config)
      - python-jose[cryptography] (JWT)
      - passlib[bcrypt] (Password hashing)
      - celery[redis] (Task queue)
      - boto3 (AWS S3)
    - Add dev dependencies:
      - pytest
      - pytest-asyncio
      - ruff (Linter)
      - mypy (Type checking)
    - Run `uv sync` to install all dependencies
    
    Avoid: Do NOT use pip directly, do NOT create requirements.txt (use pyproject.toml), do NOT use older Python versions.
  </action>
  <verify>uv run python --version shows 3.12+, uv sync completes without errors</verify>
  <done>Project initialized with all dependencies installed via uv</done>
</task>

<task type="auto">
  <n>Task 2: Create directory structure</n>
  <files>src/codestory/*, tests/</files>
  <action>
    Create the following directory structure:
    
    ```
    codestory/
    ├── src/
    │   └── codestory/
    │       ├── __init__.py
    │       ├── agents/
    │       │   ├── __init__.py
    │       │   ├── base.py          # Agent, Skill, Orchestrator classes
    │       │   ├── intent.py        # Intent Agent
    │       │   ├── analyzer.py      # Repo Analyzer Agent
    │       │   ├── architect.py     # Story Architect Agent
    │       │   └── voice.py         # Voice Director Agent
    │       ├── skills/
    │       │   ├── __init__.py
    │       │   ├── github.py        # GitHub API skills
    │       │   ├── analysis.py      # Code analysis skills
    │       │   ├── narrative.py     # Story generation skills
    │       │   └── voice.py         # ElevenLabs skills
    │       ├── api/
    │       │   ├── __init__.py
    │       │   ├── main.py          # FastAPI app
    │       │   ├── routers/
    │       │   │   ├── __init__.py
    │       │   │   ├── auth.py
    │       │   │   ├── stories.py
    │       │   │   └── users.py
    │       │   ├── middleware/
    │       │   │   └── __init__.py
    │       │   └── deps.py          # Dependencies
    │       ├── models/
    │       │   ├── __init__.py
    │       │   ├── database.py      # SQLAlchemy setup
    │       │   ├── user.py
    │       │   ├── story.py
    │       │   └── intent.py
    │       ├── core/
    │       │   ├── __init__.py
    │       │   ├── config.py        # Settings
    │       │   └── security.py      # Auth utilities
    │       └── workers/
    │           ├── __init__.py
    │           └── tasks.py         # Celery tasks
    ├── tests/
    │   ├── __init__.py
    │   ├── conftest.py
    │   └── test_placeholder.py
    ├── alembic/
    │   └── (placeholder for migrations)
    └── .env.example
    ```
    
    Each __init__.py should have a docstring describing the module's purpose.
    
    Avoid: Do NOT create deeply nested structures beyond what's shown, do NOT add functionality yet (just structure).
  </action>
  <verify>All directories exist, all __init__.py files present, `uv run python -c "import codestory"` succeeds</verify>
  <done>Complete directory structure created with proper Python package layout</done>
</task>

<task type="auto">
  <n>Task 3: Configure development tooling</n>
  <files>pyproject.toml, .gitignore, .env.example</files>
  <action>
    Add development configuration to pyproject.toml:
    
    ```toml
    [tool.ruff]
    line-length = 100
    target-version = "py312"
    
    [tool.ruff.lint]
    select = ["E", "F", "I", "UP", "B", "SIM"]
    ignore = ["E501"]
    
    [tool.mypy]
    python_version = "3.12"
    strict = true
    ignore_missing_imports = true
    
    [tool.pytest.ini_options]
    asyncio_mode = "auto"
    testpaths = ["tests"]
    ```
    
    Create comprehensive .gitignore:
    - Python bytecode (__pycache__, *.pyc)
    - Virtual environments (.venv, venv)
    - IDE files (.vscode, .idea)
    - Environment files (.env, .env.local)
    - Build artifacts (dist, build, *.egg-info)
    - Coverage reports (.coverage, htmlcov)
    - Database files (*.db, *.sqlite)
    - Audio output files (*.mp3, *.wav)
    - Log files (*.log)
    
    Create .env.example with placeholders:
    - DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/codestory
    - ANTHROPIC_API_KEY=sk-ant-...
    - ELEVENLABS_API_KEY=...
    - GITHUB_TOKEN=ghp_...
    - SECRET_KEY=your-secret-key-here
    - REDIS_URL=redis://localhost:6379
    - S3_BUCKET=codestory-audio
    - AWS_ACCESS_KEY_ID=...
    - AWS_SECRET_ACCESS_KEY=...
    
    Avoid: Do NOT include actual secrets, do NOT commit .env file.
  </action>
  <verify>`uv run ruff check src/` runs without errors, .gitignore excludes expected files</verify>
  <done>Development tooling configured: ruff, mypy, pytest, .gitignore, .env.example</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `uv sync` completes successfully
- [ ] `uv run python -c "import codestory"` succeeds
- [ ] `uv run ruff check src/` runs (may have no files to check yet)
- [ ] All directory structure matches specification
- [ ] .env.example contains all required variables
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Project can be cloned and set up with `uv sync`
- Directory structure supports planned architecture
</success_criteria>

<o>
After completion, create `plans/01-foundation/01-01-SUMMARY.md`
</o>
