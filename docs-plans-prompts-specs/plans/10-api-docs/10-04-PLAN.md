# Plan 10-04: Developer Portal and Usage Examples

## Overview
Create a developer portal with interactive documentation, code examples in multiple languages, SDK quickstarts, and integration guides. The portal serves as the primary resource for developers integrating Code Story into their applications.

## Dependencies
- Plan 10-01: API key management
- Plan 10-02: Rate limiting
- Plan 10-03: OpenAPI documentation

## Implementation

### 1. Developer Portal React Application

**apps/developer-portal/src/App.tsx:**
```typescript
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { ThemeProvider } from "@/components/theme-provider";
import { Toaster } from "@/components/ui/toaster";

import Layout from "@/components/Layout";
import HomePage from "@/pages/HomePage";
import QuickstartPage from "@/pages/QuickstartPage";
import APIReferencePage from "@/pages/APIReferencePage";
import ExamplesPage from "@/pages/ExamplesPage";
import SDKPage from "@/pages/SDKPage";
import GuidesPage from "@/pages/GuidesPage";
import PlaygroundPage from "@/pages/PlaygroundPage";

export default function App() {
  return (
    <ThemeProvider defaultTheme="system" storageKey="dev-portal-theme">
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<Layout />}>
            <Route index element={<HomePage />} />
            <Route path="quickstart" element={<QuickstartPage />} />
            <Route path="api-reference/*" element={<APIReferencePage />} />
            <Route path="examples" element={<ExamplesPage />} />
            <Route path="examples/:exampleId" element={<ExamplesPage />} />
            <Route path="sdks/:language" element={<SDKPage />} />
            <Route path="guides/*" element={<GuidesPage />} />
            <Route path="playground" element={<PlaygroundPage />} />
          </Route>
        </Routes>
      </BrowserRouter>
      <Toaster />
    </ThemeProvider>
  );
}
```

### 2. Navigation Sidebar

**components/Sidebar.tsx:**
```typescript
import { Link, useLocation } from "react-router-dom";
import { cn } from "@/lib/utils";
import {
  BookOpen,
  Code2,
  Rocket,
  FileCode,
  Terminal,
  Layers,
  Play,
} from "lucide-react";

const navigation = [
  {
    title: "Getting Started",
    items: [
      { name: "Introduction", href: "/", icon: BookOpen },
      { name: "Quickstart", href: "/quickstart", icon: Rocket },
      { name: "Authentication", href: "/guides/authentication", icon: Layers },
    ],
  },
  {
    title: "API Reference",
    items: [
      { name: "Stories", href: "/api-reference/stories", icon: FileCode },
      { name: "Chapters", href: "/api-reference/chapters", icon: FileCode },
      { name: "Voices", href: "/api-reference/voices", icon: FileCode },
      { name: "Sharing", href: "/api-reference/sharing", icon: FileCode },
    ],
  },
  {
    title: "SDKs",
    items: [
      { name: "Python", href: "/sdks/python", icon: Code2 },
      { name: "JavaScript", href: "/sdks/javascript", icon: Code2 },
      { name: "Go", href: "/sdks/go", icon: Code2 },
      { name: "cURL", href: "/sdks/curl", icon: Terminal },
    ],
  },
  {
    title: "Examples",
    items: [
      { name: "CI/CD Integration", href: "/examples/cicd", icon: Play },
      { name: "Documentation Gen", href: "/examples/docs", icon: Play },
      { name: "Webhooks", href: "/examples/webhooks", icon: Play },
    ],
  },
];

export default function Sidebar() {
  const location = useLocation();

  return (
    <nav className="w-64 border-r bg-muted/30 p-4 overflow-y-auto">
      {navigation.map((section) => (
        <div key={section.title} className="mb-6">
          <h3 className="text-sm font-semibold text-muted-foreground mb-2">
            {section.title}
          </h3>
          <ul className="space-y-1">
            {section.items.map((item) => {
              const Icon = item.icon;
              const isActive = location.pathname === item.href;

              return (
                <li key={item.href}>
                  <Link
                    to={item.href}
                    className={cn(
                      "flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors",
                      isActive
                        ? "bg-primary text-primary-foreground"
                        : "hover:bg-muted"
                    )}
                  >
                    <Icon className="h-4 w-4" />
                    {item.name}
                  </Link>
                </li>
              );
            })}
          </ul>
        </div>
      ))}
    </nav>
  );
}
```

### 3. Quickstart Page

**pages/QuickstartPage.tsx:**
```typescript
import { useState } from "react";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Copy, Check } from "lucide-react";
import CodeBlock from "@/components/CodeBlock";

const installCommands = {
  python: "pip install codestory",
  javascript: "npm install @codestory/sdk",
  go: "go get github.com/codestory/codestory-go",
};

const quickstartCode = {
  python: `from codestory import CodeStory

# Initialize client
client = CodeStory(api_key="your-api-key")

# Generate a story from a GitHub repository
story = client.stories.create(
    repo_url="https://github.com/your-org/your-repo",
    narrative_style="documentary",
    expertise_level="intermediate"
)

# Wait for generation to complete
story.wait_for_completion()

# Get the audio chapters
for chapter in story.chapters:
    print(f"{chapter.title}: {chapter.audio_url}")`,

  javascript: `import { CodeStory } from '@codestory/sdk';

// Initialize client
const client = new CodeStory({ apiKey: 'your-api-key' });

// Generate a story from a GitHub repository
const story = await client.stories.create({
  repoUrl: 'https://github.com/your-org/your-repo',
  narrativeStyle: 'documentary',
  expertiseLevel: 'intermediate',
});

// Poll for completion
await story.waitForCompletion();

// Get the audio chapters
for (const chapter of story.chapters) {
  console.log(\`\${chapter.title}: \${chapter.audioUrl}\`);
}`,

  go: `package main

import (
    "fmt"
    "github.com/codestory/codestory-go"
)

func main() {
    // Initialize client
    client := codestory.NewClient("your-api-key")

    // Generate a story from a GitHub repository
    story, err := client.Stories.Create(&codestory.CreateStoryParams{
        RepoURL:        "https://github.com/your-org/your-repo",
        NarrativeStyle: "documentary",
        ExpertiseLevel: "intermediate",
    })
    if err != nil {
        panic(err)
    }

    // Wait for generation to complete
    story.WaitForCompletion()

    // Get the audio chapters
    for _, chapter := range story.Chapters {
        fmt.Printf("%s: %s\\n", chapter.Title, chapter.AudioURL)
    }
}`,

  curl: `# Create a story
curl -X POST https://api.codestory.dev/v1/stories \\
  -H "X-API-Key: your-api-key" \\
  -H "Content-Type: application/json" \\
  -d '{
    "repo_url": "https://github.com/your-org/your-repo",
    "narrative_style": "documentary",
    "expertise_level": "intermediate"
  }'

# Response includes story_id for polling
# {"id": "story_abc123", "status": "processing", ...}

# Poll for completion
curl https://api.codestory.dev/v1/stories/story_abc123 \\
  -H "X-API-Key: your-api-key"

# When status is "completed", chapters are available
# Download audio from chapter audio_url fields`,
};

export default function QuickstartPage() {
  const [language, setLanguage] = useState<keyof typeof quickstartCode>("python");
  const [copied, setCopied] = useState<string | null>(null);

  const copyToClipboard = (text: string, key: string) => {
    navigator.clipboard.writeText(text);
    setCopied(key);
    setTimeout(() => setCopied(null), 2000);
  };

  return (
    <div className="max-w-4xl mx-auto py-8 px-4">
      <h1 className="text-3xl font-bold mb-4">Quickstart</h1>
      <p className="text-muted-foreground mb-8">
        Get up and running with Code Story in under 5 minutes. Generate your
        first audio narrative from any GitHub repository.
      </p>

      {/* Step 1: Get API Key */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <span className="bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center text-sm">
              1
            </span>
            Get Your API Key
          </CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-muted-foreground mb-4">
            Create an account at{" "}
            <a href="https://codestory.dev" className="text-primary underline">
              codestory.dev
            </a>{" "}
            and generate an API key from your dashboard settings.
          </p>
          <Button asChild>
            <a href="https://codestory.dev/dashboard/api-keys">
              Get API Key →
            </a>
          </Button>
        </CardContent>
      </Card>

      {/* Step 2: Install SDK */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <span className="bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center text-sm">
              2
            </span>
            Install the SDK
          </CardTitle>
        </CardHeader>
        <CardContent>
          <Tabs value={language} onValueChange={(v) => setLanguage(v as any)}>
            <TabsList>
              <TabsTrigger value="python">Python</TabsTrigger>
              <TabsTrigger value="javascript">JavaScript</TabsTrigger>
              <TabsTrigger value="go">Go</TabsTrigger>
              <TabsTrigger value="curl">cURL</TabsTrigger>
            </TabsList>
            <TabsContent value={language} className="mt-4">
              <div className="relative">
                <CodeBlock
                  language="bash"
                  code={installCommands[language as keyof typeof installCommands] || "# No installation needed"}
                />
                <Button
                  size="icon"
                  variant="ghost"
                  className="absolute top-2 right-2"
                  onClick={() =>
                    copyToClipboard(
                      installCommands[language as keyof typeof installCommands],
                      "install"
                    )
                  }
                >
                  {copied === "install" ? (
                    <Check className="h-4 w-4" />
                  ) : (
                    <Copy className="h-4 w-4" />
                  )}
                </Button>
              </div>
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>

      {/* Step 3: Generate Story */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <span className="bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center text-sm">
              3
            </span>
            Generate Your First Story
          </CardTitle>
        </CardHeader>
        <CardContent>
          <Tabs value={language} onValueChange={(v) => setLanguage(v as any)}>
            <TabsList>
              <TabsTrigger value="python">Python</TabsTrigger>
              <TabsTrigger value="javascript">JavaScript</TabsTrigger>
              <TabsTrigger value="go">Go</TabsTrigger>
              <TabsTrigger value="curl">cURL</TabsTrigger>
            </TabsList>
            <TabsContent value={language} className="mt-4">
              <div className="relative">
                <CodeBlock
                  language={language === "curl" ? "bash" : language}
                  code={quickstartCode[language]}
                />
                <Button
                  size="icon"
                  variant="ghost"
                  className="absolute top-2 right-2"
                  onClick={() =>
                    copyToClipboard(quickstartCode[language], "code")
                  }
                >
                  {copied === "code" ? (
                    <Check className="h-4 w-4" />
                  ) : (
                    <Copy className="h-4 w-4" />
                  )}
                </Button>
              </div>
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>

      {/* Next Steps */}
      <Card>
        <CardHeader>
          <CardTitle>Next Steps</CardTitle>
        </CardHeader>
        <CardContent>
          <ul className="space-y-2">
            <li>
              <a href="/guides/narrative-styles" className="text-primary underline">
                Explore narrative styles
              </a>{" "}
              - Learn about fiction, documentary, tutorial, podcast, and technical styles
            </li>
            <li>
              <a href="/guides/customization" className="text-primary underline">
                Customize your stories
              </a>{" "}
              - Edit chapters, adjust pacing, and select voices
            </li>
            <li>
              <a href="/examples/cicd" className="text-primary underline">
                CI/CD integration
              </a>{" "}
              - Auto-generate stories on every release
            </li>
          </ul>
        </CardContent>
      </Card>
    </div>
  );
}
```

### 4. Code Block Component

**components/CodeBlock.tsx:**
```typescript
import { useEffect, useRef } from "react";
import Prism from "prismjs";
import "prismjs/themes/prism-tomorrow.css";
import "prismjs/components/prism-python";
import "prismjs/components/prism-javascript";
import "prismjs/components/prism-typescript";
import "prismjs/components/prism-go";
import "prismjs/components/prism-bash";
import "prismjs/components/prism-json";

interface CodeBlockProps {
  code: string;
  language: string;
  showLineNumbers?: boolean;
}

export default function CodeBlock({
  code,
  language,
  showLineNumbers = true,
}: CodeBlockProps) {
  const codeRef = useRef<HTMLElement>(null);

  useEffect(() => {
    if (codeRef.current) {
      Prism.highlightElement(codeRef.current);
    }
  }, [code, language]);

  return (
    <div className="rounded-lg overflow-hidden bg-[#2d2d2d]">
      <pre className={`${showLineNumbers ? "line-numbers" : ""} !m-0 !bg-transparent`}>
        <code ref={codeRef} className={`language-${language}`}>
          {code}
        </code>
      </pre>
    </div>
  );
}
```

### 5. API Playground

**pages/PlaygroundPage.tsx:**
```typescript
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import CodeBlock from "@/components/CodeBlock";
import { Play, Loader2 } from "lucide-react";

interface RequestParams {
  endpoint: string;
  method: string;
  body: string;
}

export default function PlaygroundPage() {
  const [apiKey, setApiKey] = useState("");
  const [endpoint, setEndpoint] = useState("/v1/stories");
  const [method, setMethod] = useState("POST");
  const [body, setBody] = useState(
    JSON.stringify(
      {
        repo_url: "https://github.com/facebook/react",
        narrative_style: "documentary",
        expertise_level: "intermediate",
      },
      null,
      2
    )
  );
  const [response, setResponse] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const endpoints = [
    { value: "/v1/stories", label: "POST /v1/stories - Create Story" },
    { value: "/v1/stories/{id}", label: "GET /v1/stories/{id} - Get Story" },
    { value: "/v1/stories", label: "GET /v1/stories - List Stories" },
    { value: "/v1/voices", label: "GET /v1/voices - List Voices" },
    { value: "/v1/voices/preview", label: "POST /v1/voices/preview - Preview Voice" },
  ];

  const executeRequest = async () => {
    if (!apiKey) {
      setResponse(JSON.stringify({ error: "API key required" }, null, 2));
      return;
    }

    setLoading(true);
    try {
      const url = `https://api.codestory.dev${endpoint}`;
      const options: RequestInit = {
        method,
        headers: {
          "X-API-Key": apiKey,
          "Content-Type": "application/json",
        },
      };

      if (method !== "GET" && body) {
        options.body = body;
      }

      const res = await fetch(url, options);
      const data = await res.json();
      setResponse(JSON.stringify(data, null, 2));
    } catch (error) {
      setResponse(
        JSON.stringify({ error: "Request failed", details: String(error) }, null, 2)
      );
    } finally {
      setLoading(false);
    }
  };

  const generateCurl = () => {
    let curl = `curl -X ${method} "https://api.codestory.dev${endpoint}"`;
    curl += ` \\\n  -H "X-API-Key: ${apiKey || "YOUR_API_KEY"}"`;
    curl += ` \\\n  -H "Content-Type: application/json"`;
    if (method !== "GET" && body) {
      curl += ` \\\n  -d '${body.replace(/\n/g, "")}'`;
    }
    return curl;
  };

  return (
    <div className="max-w-6xl mx-auto py-8 px-4">
      <h1 className="text-3xl font-bold mb-4">API Playground</h1>
      <p className="text-muted-foreground mb-8">
        Test API endpoints interactively. Enter your API key to make live
        requests.
      </p>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Request Panel */}
        <Card>
          <CardHeader>
            <CardTitle>Request</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div>
              <Label htmlFor="apiKey">API Key</Label>
              <Input
                id="apiKey"
                type="password"
                placeholder="cs_live_..."
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
              />
            </div>

            <div className="grid grid-cols-3 gap-2">
              <div>
                <Label>Method</Label>
                <Select value={method} onValueChange={setMethod}>
                  <SelectTrigger>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="GET">GET</SelectItem>
                    <SelectItem value="POST">POST</SelectItem>
                    <SelectItem value="PUT">PUT</SelectItem>
                    <SelectItem value="DELETE">DELETE</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              <div className="col-span-2">
                <Label>Endpoint</Label>
                <Input
                  value={endpoint}
                  onChange={(e) => setEndpoint(e.target.value)}
                  placeholder="/v1/stories"
                />
              </div>
            </div>

            <div>
              <Label>Quick Select</Label>
              <Select
                value=""
                onValueChange={(v) => {
                  const [ep] = v.split(" - ");
                  const [m, path] = ep.split(" ");
                  setMethod(m);
                  setEndpoint(path);
                }}
              >
                <SelectTrigger>
                  <SelectValue placeholder="Choose an endpoint..." />
                </SelectTrigger>
                <SelectContent>
                  {endpoints.map((ep) => (
                    <SelectItem key={ep.label} value={ep.label}>
                      {ep.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            {method !== "GET" && (
              <div>
                <Label>Request Body (JSON)</Label>
                <Textarea
                  value={body}
                  onChange={(e) => setBody(e.target.value)}
                  className="font-mono text-sm"
                  rows={8}
                />
              </div>
            )}

            <Button onClick={executeRequest} disabled={loading} className="w-full">
              {loading ? (
                <Loader2 className="h-4 w-4 animate-spin mr-2" />
              ) : (
                <Play className="h-4 w-4 mr-2" />
              )}
              Execute Request
            </Button>

            {/* Generated cURL */}
            <div>
              <Label>cURL Command</Label>
              <CodeBlock language="bash" code={generateCurl()} />
            </div>
          </CardContent>
        </Card>

        {/* Response Panel */}
        <Card>
          <CardHeader>
            <CardTitle>Response</CardTitle>
          </CardHeader>
          <CardContent>
            {response ? (
              <CodeBlock language="json" code={response} />
            ) : (
              <div className="text-center py-12 text-muted-foreground">
                Execute a request to see the response
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

### 6. CI/CD Integration Example

**content/examples/cicd.mdx:**
```mdx
# CI/CD Integration

Generate audio documentation for every release automatically.

## GitHub Actions

Create `.github/workflows/codestory.yml`:

\`\`\`yaml
name: Generate Code Story

on:
  release:
    types: [published]

jobs:
  generate-story:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install Code Story CLI
        run: pip install codestory

      - name: Generate Story
        env:
          CODESTORY_API_KEY: \${{ secrets.CODESTORY_API_KEY }}
        run: |
          codestory generate \\
            --repo \${{ github.repository }} \\
            --style documentary \\
            --output ./release-story.mp3 \\
            --title "Release \${{ github.event.release.tag_name }}"

      - name: Upload to Release
        uses: softprops/action-gh-release@v1
        with:
          files: release-story.mp3
\`\`\`

## GitLab CI

Add to `.gitlab-ci.yml`:

\`\`\`yaml
generate_story:
  stage: deploy
  image: python:3.12
  only:
    - tags
  script:
    - pip install codestory
    - codestory generate
        --repo $CI_PROJECT_URL
        --style tutorial
        --output ./docs/audio-guide.mp3
  artifacts:
    paths:
      - docs/audio-guide.mp3
\`\`\`

## Webhook Integration

Set up a webhook to generate stories on demand:

\`\`\`python
from flask import Flask, request
from codestory import CodeStory

app = Flask(__name__)
client = CodeStory(api_key=os.environ["CODESTORY_API_KEY"])

@app.route("/webhook/generate", methods=["POST"])
def generate_story():
    data = request.json
    
    story = client.stories.create(
        repo_url=data["repository"]["html_url"],
        narrative_style="technical",
        webhook_url=data.get("callback_url")
    )
    
    return {"story_id": story.id, "status": "processing"}
\`\`\`
```

## File Structure
```
apps/
└── developer-portal/
    ├── src/
    │   ├── components/
    │   │   ├── Layout.tsx
    │   │   ├── Sidebar.tsx
    │   │   ├── CodeBlock.tsx
    │   │   └── APIEndpoint.tsx
    │   ├── pages/
    │   │   ├── HomePage.tsx
    │   │   ├── QuickstartPage.tsx
    │   │   ├── APIReferencePage.tsx
    │   │   ├── ExamplesPage.tsx
    │   │   ├── SDKPage.tsx
    │   │   ├── GuidesPage.tsx
    │   │   └── PlaygroundPage.tsx
    │   └── content/
    │       ├── examples/
    │       │   ├── cicd.mdx
    │       │   ├── docs.mdx
    │       │   └── webhooks.mdx
    │       └── guides/
    │           ├── authentication.mdx
    │           ├── narrative-styles.mdx
    │           └── customization.mdx
    ├── package.json
    └── vite.config.ts
```

## Validation Gates

### Gate 1: Portal Navigation
```typescript
test("developer portal navigation", async ({ page }) => {
  await page.goto("/developers");
  
  // Sidebar navigation
  await page.click('text=Quickstart');
  await expect(page).toHaveURL(/quickstart/);
  
  await page.click('text=Python');
  await expect(page).toHaveURL(/sdks\/python/);
  
  await page.click('text=API Reference');
  await expect(page.locator("h1")).toContainText("API Reference");
});
```

### Gate 2: Code Examples Display
```typescript
test("code examples with language switching", async ({ page }) => {
  await page.goto("/developers/quickstart");
  
  // Default shows Python
  await expect(page.locator("code.language-python")).toBeVisible();
  
  // Switch to JavaScript
  await page.click('button:has-text("JavaScript")');
  await expect(page.locator("code.language-javascript")).toBeVisible();
  
  // Copy button works
  await page.click('button[aria-label="Copy code"]');
  // Clipboard contains code
});
```

### Gate 3: API Playground
```typescript
test("API playground executes request", async ({ page }) => {
  await page.goto("/developers/playground");
  
  // Enter API key
  await page.fill('input[placeholder*="cs_live"]', "test_key");
  
  // Select endpoint
  await page.selectOption('select', 'GET /v1/voices - List Voices');
  
  // Execute (will fail with test key, but shows response)
  await page.click('button:has-text("Execute")');
  
  // Response panel updates
  await expect(page.locator("text=Response")).toBeVisible();
});
```

### Gate 4: Search Functionality
```typescript
test("documentation search", async ({ page }) => {
  await page.goto("/developers");
  
  // Open search
  await page.keyboard.press("Meta+k");
  
  // Search for term
  await page.fill('input[placeholder*="Search"]', "authentication");
  
  // Results appear
  await expect(page.locator("text=API Key Authentication")).toBeVisible();
  
  // Click result navigates
  await page.click("text=API Key Authentication");
  await expect(page).toHaveURL(/authentication/);
});
```

## Definition of Done
- [ ] Developer portal React application
- [ ] Navigation sidebar with all sections
- [ ] Quickstart page with multi-language examples
- [ ] Code block component with syntax highlighting
- [ ] API playground with live request execution
- [ ] CI/CD integration examples (GitHub, GitLab)
- [ ] SDK documentation pages (Python, JS, Go, cURL)
- [ ] Search functionality across documentation
- [ ] Mobile-responsive layout
- [ ] All validation gates passing
